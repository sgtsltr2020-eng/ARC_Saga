# ADR-001: SQLite + Copilot Integration Rationale

**Status:** Accepted  
**Date:** 2025-12-05  
**Deciders:** ARC SAGA Architecture Team  
**Context:** Phase 2.4 prioritizes desktop-first deployment with minimal infrastructure overhead.

## Decision

We will use SQLite as the primary storage backend and Microsoft Copilot as the primary reasoning engine, rather than PostgreSQL + distributed event sourcing in Phase 2.4.

## Rationale

### SQLite Selection

1. **Zero Infrastructure Overhead**: Single-file deployment eliminates database server setup, connection pooling complexity, and operational burden for desktop users.
2. **ACID Compliance**: SQLite provides full ACID guarantees for single-user scenarios, sufficient for Phase 2.4's scope.
3. **FTS5 Full-Text Search**: Built-in FTS5 indexes provide sub-100ms search performance for typical conversation volumes (10K-100K messages).
4. **Migration Path**: SQLite → PostgreSQL migration is straightforward via schema export and can be deferred until multi-user scaling is required.
5. **Windows Compatibility**: Native SQLite support on Windows without external dependencies.

### Copilot Integration Priority

1. **Enterprise OAuth Integration**: Copilot leverages existing Entra ID (Azure AD) credentials, eliminating separate authentication flows.
2. **Cost Efficiency**: Copilot tokens are included in Microsoft 365 subscriptions, reducing per-query costs compared to OpenAI API.
3. **Desktop-First Design**: Copilot is optimized for desktop integration, matching ARC SAGA's Phase 2.4 target.
4. **Protocol Abstraction**: `IReasoningEngine` protocol allows seamless provider switching (Copilot → LiteLLM → Claude) without code changes.

## Consequences

**Positive:**

- Rapid desktop deployment without infrastructure setup
- Lower operational costs (no database server)
- Faster development velocity (fewer moving parts)

**Negative:**

- Limited concurrent write throughput (SQLite)
- No built-in replication (single-file storage)
- Desktop-only deployment model in Phase 2.4

**Mitigations:**

- PostgreSQL migration path documented in ADR-003
- Event sourcing design prepared but deferred to Phase 3
- Connection pooling patterns abstracted via `StorageBackend` protocol

## Alternatives Considered

1. **PostgreSQL from Day 1**: Rejected due to operational complexity for desktop users.
2. **DuckDB**: Rejected due to weaker Windows ecosystem support.
3. **LiteLLM Primary**: Rejected due to cost and lack of enterprise OAuth integration.

## References

- SQLite FTS5 Documentation: https://www.sqlite.org/fts5.html
- Copilot API Documentation: https://learn.microsoft.com/en-us/copilot/extensibility
- Phase 2.4 Architecture Rules: `.cursorrules` (architecture.mdc)
